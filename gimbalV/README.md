# STM32-CAN-M3508-M2006-GM6020

使用robomaster官方C板基于CAN总线驱动M2006电机（M3508、M2006、GM6020均可使用），程序使用CubeMX基于1.25.0版固件库生成，大部分核心程序参考自官方例程。  

主要工作为将官方使用的1.18.0版CubeMX固件使用1.25.0版固件改写，改写了已经弃用的一些函数和宏，仍使用中断接收。

# 参考资料
Robomaster C板： https://www.robomaster.com/zh-CN/products/components/general/development-board-type-c#downloads  
M2006：https://www.robomaster.com/zh-CN/products/components/general/M2006




更新日志
v0.4，加入了初步分类框架文件夹

v0.5,加入了4个底层框架实用版，并分离了motor文件与bsp_can文件

v0.6,加入了离线检测freertos进程框架Daemontask

v0.7，加入了四个架构的cmake自动添加include目录

v0.8,更改了底盘任务名，把can电机接收数据放入motor

v0.85,删去了部分无用的注释和无关函数，添加了部分相关函数的注释

v0.88,再一次删去无关代码与注释，添加部分优化代码与注释

v0.90,再次优化可读性，删去无关的文件夹，添加初步串口发送功能

v0.95,更改调试串口模式为DMA发送，减少运算负担，完善bsp_uart.c文件

v1.00，正式版！增加了离线检测功能（原理可行，但暂时未找到测试方式），大幅优化代码

v1.01，加入了收到遥控器后才开始发送电机数据的设置(by Mr.Guan)

v1.1,改进了遥控器检测，改进部分代码可读性

v1.2,修改了bsp发送和电机发送函数，使其可以在发送时选择can组别，添加了扩展性

v1.25,扩展了pid和电机数据的结构体数组容量，为以后8个电机控制做铺垫

v1.3,添加了can2，扩展了滤波器初始化设置参数，增加扩展性
(但目前存在不能开启can2接受的bug，当开启can2总线，can2滤波器设置，can2中断后
会导致can1的接收出问题，体现在当接受遥控器数据后，有一个电机呈现阻塞态，忽快忽慢)
//不确定这是否是can2中断开启成功的标志

v1.35,解决了v1.3的问腿，现在可以正常接受can1can2中断而互不干扰了

v1.4,扩展了其他电机id的接受设置,直至目前几乎全面扩展了can1和can2的接受配置，仅剩
__HAL_CAN_ENABLE_IT函数（在bsp_can.c的can终端回调函数）未知是否需要改变，但从目前
来看，如果改成hcan2也对hcan1的收发没有影响

v1.5,成功使能了can1和can2中断(目前都用的各自的fifo0队列)，准备增加自定义canid和data数据的多板通信，所以
要改变一下接受与发送的架构

v1.51,在回调函数里添加了判断can1can2的扩展

V1.55,优化了发送部分，使其更适应以后的多板通信(优雅)

v1.6,加入了多板通信，修改了main函数中pid初始化不成功的问题，优化了离线检测的逻辑（未启用）

v1.65,成功设置can1can2同时发送与接受，另外用电流值初步控制云台，实现云台与底盘同时控制
（目前存在pid可能无法应用于can2的问题，怀疑是pid底层的问题）

v1.68，成功给yaw轴电机套上速度环

v1.70,配置了6020角度环（但未调pid），重设电源方向为正方向

v1.75,添加了多机通信的收发

v1.80,添加了调好的6020pid

v1.81简单修改pid参数，映射遥控器位置值

vt2.00，删除了大萌陀螺仪的配置，解决了一个can发送重复的严重错误，添加了底盘跟随模式

--------------------------------------一以下为云台版本----------------

v0.1

v0.2,加入了达妙云台，但目前发现达妙云台发can包与大疆电机发can包会冲突，正在修复中

v0.3,加入了判断邮箱空闲的设定，初步控制发射机构，但pid仍存在bug，正在修复中

v0.4,找到了0.3的问题是can接受未成功，can接受的id判断有问题导致收不到正常电机数据导致pid获取不到
正常的参数，现已改正一个，后续改正全部及优化代码逻辑

v0.5,云台暂时最终版，改正了判断，等待修复代码逻辑

v0.6,优化了一部分参数